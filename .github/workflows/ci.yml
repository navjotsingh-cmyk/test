name: Init New Repo with Generator

on:
  workflow_dispatch:
    inputs:
      repo_name:
        description: "Name of the new GitHub repo"
        required: true

jobs:
  create-repo:
    runs-on: self-hosted  # since you're using your laptop as runner
    steps:
      - name: Create GitHub repository with API
        run: |
          curl -X POST \
            -H "Authorization: token ${{ secrets.PAT_TOKEN }}" \
            -H "Accept: application/vnd.github+json" \
            https://api.github.com/user/repos \
            -d '{"name":"${{ github.event.inputs.repo_name }}","private":false}'

      - name: Scaffold New Project with Yeoman
        run: |
          mkdir ${{ github.event.inputs.repo_name }}
          cd ${{ github.event.inputs.repo_name }}

          # Yeoman is already installed on your runner
          yo @witsinnovationlab/wits-project-generator:node-ts --no-insight --skip-install

      - name: Push to Repo
        run: |
          cd ${{ github.event.inputs.repo_name }}
          git init
          git branch -M main
          git remote add origin https://github.com/${{ github.repository_owner }}/${{ github.event.inputs.repo_name }}.git
          git add .
          git commit -m "Initial commit from generator"
          git push origin main
